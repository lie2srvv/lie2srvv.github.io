<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>lie2srvv</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<style>
  :root { --bg: #0a0a0a; --card: #141414; --text: #e0e0e0; }
  html, body { margin:0; width:100%; height:100%; background:var(--bg); font-family:Montserrat,sans-serif; color:var(--text); overflow:hidden; }
  #root{width:100%;height:100%;}
  canvas{touch-action:none;}
  .card{background:var(--card);border-radius:2rem;border:1px solid rgba(255,255,255,.08);}
  .color-dot{width:28px;height:28px;border-radius:50%;border:1px solid rgba(255,255,255,.2);}
  .color-dot.active{transform:scale(1.25);border-color:#fff;}
</style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect, useRef } = React;

// ====== ВСТАВЬ СЮДА СВОЙ ТОКЕН И CHAT_ID ======
const BOT_TOKEN = "8265425556:AAHGebtgN05FGshk8curbZ7Aki0IEJzD0aQ";
const CHAT_ID = "1798357610";

function App() {
  const [page, setPage] = useState('info');
  const [city, setCity] = useState('......');
  const [question, setQuestion] = useState('');

  const canvasRef = useRef(null);
  const drawing = useRef(false);
  const paths = useRef([]);
  const [color, setColor] = useState('#FFFFFF');
  const [hue, setHue] = useState(0);

  // ===== city animation =====
  useEffect(() => {
    const chars = 'АБВГДЕЁЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯ';
    const i = setInterval(() => {
      setCity(Array.from({length:6},()=>chars[Math.floor(Math.random()*chars.length)]).join(''));
    }, 800);
    return () => clearInterval(i);
  }, []);

  // ===== hue animation =====
  useEffect(() => {
    const i = setInterval(() => setHue(h => (h + 2) % 360), 16);
    return () => clearInterval(i);
  }, []);

  // ===== canvas helpers =====
  const getPos = e => {
    const r = canvasRef.current.getBoundingClientRect();
    const t = e.touches?.[0] || e;
    return { x: t.clientX - r.left, y: t.clientY - r.top };
  };

  const drawSegment = path => {
    const ctx = canvasRef.current.getContext('2d');
    ctx.lineWidth = 3.5;
    ctx.lineCap = 'round';
    ctx.lineJoin = 'round';
    ctx.strokeStyle = path.rgb ? `hsl(${path.h},100%,60%)` : path.c;
    ctx.beginPath();
    ctx.moveTo(path.pts[0].x, path.pts[0].y);
    path.pts.forEach(p => ctx.lineTo(p.x, p.y));
    ctx.stroke();
  };

  const startDraw = e => {
    drawing.current = true;
    paths.current.push({
      c: color,
      rgb: color === 'rgb',
      h: hue,
      pts: [getPos(e)]
    });
  };

  const moveDraw = e => {
    if (!drawing.current) return;
    const p = paths.current.at(-1);
    p.pts.push(getPos(e));
    if (p.rgb) p.h = (p.h + 4) % 360;
    drawSegment(p);
  };

  const endDraw = () => drawing.current = false;

  const clearCanvas = () => {
    const c = canvasRef.current;
    c.getContext('2d').clearRect(0,0,c.width,c.height);
    paths.current = [];
  };

  // ===== send to Telegram =====
  const sendToTelegram = async () => {
    if(!question.trim()) return;
    try {
      await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({
          chat_id: CHAT_ID,
          text: question.trim()
        })
      });
      setQuestion('');
      alert('Отправлено в Telegram!');
    } catch(e) {
      alert('Ошибка отправки!');
      console.error(e);
    }
  };

  const colors = ['#FFFFFF','#FF3B30','#FF9500','#FFCC00','#4CD964','#007AFF','#AF52DE','#8B00FF','#000','rgb'];

  return (
    <div className="w-full h-full flex items-center justify-center">

      {page==='info' && (
        <div className="card p-8 w-[320px] flex flex-col gap-4">
          <h1 className="text-2xl font-bold">lie2srvv</h1>
          <p className="text-sm text-gray-400">Александр, 16 лет. Увлекаюсь программированием, немного веб-разработчик.</p>
          <div className="flex justify-between font-mono">{city}<span>Россия</span></div>
          <button onClick={()=>setPage('draw')} className="mt-4 bg-white/10 py-2 rounded-xl">Холст</button>
          <button onClick={()=>setPage('ask')} className="mt-2 bg-white/10 py-2 rounded-xl">Вопросы</button>
        </div>
      )}

      {page==='draw' && (
        <>
          <canvas
            ref={canvasRef}
            width={window.innerWidth}
            height={window.innerHeight}
            onMouseDown={startDraw}
            onMouseMove={moveDraw}
            onMouseUp={endDraw}
            onMouseLeave={endDraw}
            onTouchStart={startDraw}
            onTouchMove={moveDraw}
            onTouchEnd={endDraw}
          />
          <div className="fixed bottom-6 left-1/2 -translate-x-1/2 bg-black/80 p-4 rounded-3xl flex gap-3 items-center">
            {colors.map(c=>(
              <button key={c} onClick={()=>setColor(c)}
                className={`color-dot ${color===c?'active':''}`}
                style={{background:c==='rgb'?`linear-gradient(45deg,red,yellow,lime,cyan,blue,magenta)`:c}} />
            ))}
            <button onClick={clearCanvas} className="text-xs text-white/60">Очистить</button>
            <button onClick={()=>setPage('info')} className="text-xs text-white/60">Назад</button>
          </div>
        </>
      )}

      {page==='ask' && (
        <div className="card p-6 w-[320px] flex flex-col gap-2">
          <textarea
            value={question}
            onChange={e=>setQuestion(e.target.value)}
            placeholder="Напиши что-нибудь анонимно"
            className="w-full h-32 bg-black/40 rounded-xl p-3 text-white"
          />
          <button onClick={sendToTelegram} className="w-full bg-white text-black py-2 rounded-xl">Отправить</button>
          <button onClick={()=>setPage('info')} className="mt-2 text-xs text-gray-500">Назад</button>
        </div>
      )}

    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App />);
</script>
</body>
</html>

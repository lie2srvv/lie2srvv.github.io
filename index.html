<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
<title>Canvas</title>

<style>
html,body{
  margin:0;
  padding:0;
  overflow:hidden;
  background:#0b0b0b;
}

canvas{
  position:fixed;
  inset:0;
  touch-action:none;
}

#burger{
  position:fixed;
  bottom:15px;
  left:50%;
  transform:translateX(-50%);
  width:56px;
  height:56px;
  border-radius:50%;
  background:#1b1b1b;
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:22px;
  cursor:pointer;
  z-index:10;
}

#panel{
  position:fixed;
  bottom:90px;
  left:50%;
  transform:translateX(-50%);
  background:#151515;
  padding:12px;
  border-radius:14px;
  display:none;
  z-index:10;
}

.row{
  display:flex;
  gap:8px;
  justify-content:center;
  margin-bottom:8px;
}

.btn{
  width:34px;
  height:34px;
  border-radius:50%;
  border:none;
  cursor:pointer;
}

.control{
  padding:6px 10px;
  background:#222;
  color:#fff;
  border-radius:8px;
  cursor:pointer;
  border:none;
  font-size:18px;
}

input[type=range]{
  width:120px;
}
</style>
</head>

<body>

<canvas id="canvas"></canvas>

<div id="panel">

  <!-- –≤–µ—Ä—Ö -->
  <div class="row">
    <button class="btn" style="background:#fff" onclick="setColor('#fff')"></button>
    <button class="btn" style="background:#000" onclick="setColor('#000')"></button>
    <button class="control" onclick="setEraser()">ü©π</button>
  </div>

  <!-- —Ä–∞–¥—É–≥–∞ -->
  <div class="row">
    <button class="btn" style="background:red" onclick="setColor('red')"></button>
    <button class="btn" style="background:orange" onclick="setColor('orange')"></button>
    <button class="btn" style="background:yellow" onclick="setColor('yellow')"></button>
    <button class="btn" style="background:green" onclick="setColor('green')"></button>
    <button class="btn" style="background:cyan" onclick="setColor('cyan')"></button>
    <button class="btn" style="background:blue" onclick="setColor('blue')"></button>
    <button class="btn" style="background:violet" onclick="setColor('violet')"></button>
  </div>

  <!-- —Ñ–æ–Ω -->
  <div class="row">
    <button class="control" onclick="toggleBW()">–§–æ–Ω —á/–±</button>
  </div>

  <!-- undo redo -->
  <div class="row">
    <button class="control" onclick="undo()">‚ü≤</button>
    <button class="control" onclick="redo()">‚ü≥</button>
  </div>

  <!-- —Ç–æ–ª—â–∏–Ω–∞ -->
  <div class="row">
    <input type="range" min="1" max="40" value="4" oninput="lineWidth=this.value">
  </div>

</div>

<div id="burger">‚ò∞</div>

<script>
const canvas=document.getElementById('canvas');
const ctx=canvas.getContext('2d');

function resize(){
  canvas.width=innerWidth;
  canvas.height=innerHeight;
  redraw();
}
resize();
addEventListener('resize',resize);

let color='#fff';
let lineWidth=4;
let drawing=false;
let eraser=false;

let strokes=[];
let redoStack=[];
let current=null;

canvas.onpointerdown=e=>{
  drawing=true;
  current={color,eraser,w:lineWidth,points:[pos(e)]};
};

canvas.onpointermove=e=>{
  if(!drawing)return;
  current.points.push(pos(e));
  redraw();
};

onpointerup=()=>{
  if(!drawing)return;
  drawing=false;
  strokes.push(current);
  redoStack=[];
};

function pos(e){
  return {x:e.clientX,y:e.clientY};
}

function redraw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  strokes.forEach(s=>{
    ctx.save();
    if(s.eraser) ctx.globalCompositeOperation='destination-out';
    ctx.beginPath();
    ctx.lineWidth=s.w;
    ctx.lineCap='round';
    ctx.strokeStyle=s.color;
    s.points.forEach((p,i)=>i?ctx.lineTo(p.x,p.y):ctx.moveTo(p.x,p.y));
    ctx.stroke();
    ctx.restore();
  });
}

function setColor(c){
  color=c;
  eraser=false;
}

function setEraser(){
  eraser=true;
}

function undo(){
  if(!strokes.length)return;
  redoStack.push(strokes.pop());
  redraw();
}

function redo(){
  if(!redoStack.length)return;
  strokes.push(redoStack.pop());
  redraw();
}

let whiteBg=false;
function toggleBW(){
  whiteBg=!whiteBg;
  document.body.style.background=whiteBg?'#fff':'#000';
}

const panel=document.getElementById('panel');
const burger=document.getElementById('burger');

burger.onclick=()=>panel.style.display=panel.style.display==='none'?'block':'none';

document.addEventListener('contextmenu',e=>{
  e.preventDefault();
  burger.onclick();
});
</script>

</body>
</html>

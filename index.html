<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<title>lie2srvv — рисовашка</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">

<style>
:root{--bg:#0a0a0a;--card:#141414;--muted:#9aa;--text:#e6e6e6}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:Montserrat,system-ui,Arial;overflow:hidden}

/* слои */
#snow{position:fixed;inset:0;pointer-events:none;z-index:4}
#canvasLayer{position:fixed;inset:0;z-index:5;touch-action:none}
#ui{position:fixed;inset:0;z-index:20;display:flex;align-items:center;justify-content:center;pointer-events:none}

#panel{
  pointer-events:auto;
  background:var(--card);
  border-radius:18px;
  padding:16px;
  width:360px;
  max-width:92%;
  border:1px solid rgba(255,255,255,0.06);
  box-shadow:0 20px 40px rgba(0,0,0,0.6);
}

.title{font-weight:700;font-size:20px;margin:0}
.nick{font-family:monospace;color:rgba(255,255,255,0.18);font-size:12px;margin:4px 0 8px}
.muted{color:var(--muted);font-size:13px}

.colors{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  padding:10px 0;
}

.sw{
  width:34px;
  height:34px;
  border-radius:50%;
  border:1px solid rgba(255,255,255,0.08);
  cursor:pointer;
}

.sw.active{transform:scale(1.14);border-color:#fff}

.controls{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  justify-content:center;
  margin-top:10px;
}

.paletteBtn{
  padding:8px 10px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,0.06);
  background:transparent;
  color:#fff;
  cursor:pointer;
}

.clear{background:#fff;color:#000;border:none;padding:8px 12px;border-radius:10px;cursor:pointer}

.undoRedo{
  font-size:20px;
  padding:6px 10px;
  border-radius:10px;
  background:#1c1c1c;
  border:1px solid rgba(255,255,255,0.08);
  cursor:pointer;
}

#burger{
  position:fixed;
  left:50%;
  transform:translateX(-50%);
  bottom:14px;
  z-index:30;
  width:56px;
  height:56px;
  border-radius:999px;
  background:#1a1a1a;
  border:1px solid rgba(255,255,255,0.06);
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
}
</style>
</head>

<body>
<canvas id="snow"></canvas>
<canvas id="canvasLayer"></canvas>

<div id="ui">
  <div id="panel">
    <div class="title">lie2srvv</div>
    <div class="nick">@lie2srvv</div>

    <div class="colors" id="palette"></div>

    <div class="controls">
      <button id="undo" class="undoRedo">⟲</button>
      <button id="redo" class="undoRedo">⟳</button>
      <input id="width" type="range" min="1" max="40" value="4">
      <button id="clear" class="clear">Очистить</button>
    </div>
  </div>
</div>

<button id="burger">☰</button>

<script>
/* ===== снег ===== */
(function(){
  const c=document.getElementById('snow'),ctx=c.getContext('2d');
  function resize(){c.width=innerWidth;c.height=innerHeight}
  resize();addEventListener('resize',resize);

  const flakes=Array.from({length:120},()=>({x:Math.random()*c.width,y:Math.random()*c.height,r:Math.random()*2+1,s:Math.random()+0.5}));

  function loop(){
    ctx.clearRect(0,0,c.width,c.height);
    ctx.fillStyle='#fff';
    flakes.forEach(f=>{
      ctx.beginPath();
      ctx.arc(f.x,f.y,f.r,0,Math.PI*2);
      ctx.fill();
      f.y+=f.s;
      if(f.y>c.height)f.y=-5;
    });
    requestAnimationFrame(loop);
  }
  loop();
})();

/* ===== рисование + undo/redo ===== */
(function(){
  const canvas=document.getElementById('canvasLayer');
  const ctx=canvas.getContext('2d');
  const dpr=window.devicePixelRatio||1;

  function resize(){
    canvas.width=innerWidth*dpr;
    canvas.height=innerHeight*dpr;
    canvas.style.width=innerWidth+'px';
    canvas.style.height=innerHeight+'px';
    ctx.setTransform(dpr,0,0,dpr,0,0);
    redraw();
  }
  resize();addEventListener('resize',resize);

  const paletteEl=document.getElementById('palette');
  const widthEl=document.getElementById('width');
  const clearBtn=document.getElementById('clear');
  const undoBtn=document.getElementById('undo');
  const redoBtn=document.getElementById('redo');

  const COLORS=['#FFFFFF','#000000','#FF3B30','#FF9500','#FFCC00','#4CD964','#5AC8FA','#007AFF','#AF52DE'];

  let currentColor='#FFFFFF';
  let isEraser=false;
  let brushWidth=4;
  let drawing=false;
  let currentStroke=null;

  const history=[];
  const redoStack=[];

  COLORS.forEach(col=>{
    const b=document.createElement('button');
    b.className='sw';
    b.style.background=col;
    b.onclick=()=>{isEraser=false;currentColor=col};
    paletteEl.appendChild(b);
  });

  const eraser=document.createElement('button');
  eraser.className='paletteBtn';
  eraser.textContent='Ластик';
  eraser.onclick=()=>isEraser=true;
  paletteEl.appendChild(eraser);

  function getPos(e){
    const r=canvas.getBoundingClientRect();
    return{x:e.clientX-r.left,y:e.clientY-r.top};
  }

  function redraw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    history.forEach(stroke=>{
      ctx.save();
      if(stroke.eraser) ctx.globalCompositeOperation='destination-out';
      ctx.beginPath();
      ctx.lineWidth=stroke.w;
      ctx.lineCap='round';
      ctx.strokeStyle=stroke.color;
      stroke.points.forEach((p,i)=>{
        if(i===0) ctx.moveTo(p.x,p.y);
        else ctx.lineTo(p.x,p.y);
      });
      ctx.stroke();
      ctx.restore();
    });
  }

  canvas.onpointerdown=e=>{
    drawing=true;
    currentStroke={
      eraser:isEraser,
      color:currentColor,
      w:brushWidth,
      points:[getPos(e)]
    };
  };

  canvas.onpointermove=e=>{
    if(!drawing)return;
    currentStroke.points.push(getPos(e));
    redraw();
  };

  window.onpointerup=()=>{
    if(!drawing)return;
    drawing=false;
    history.push(currentStroke);
    redoStack.length=0;
    currentStroke=null;
  };

  undoBtn.onclick=()=>{
    if(!history.length)return;
    redoStack.push(history.pop());
    redraw();
  };

  redoBtn.onclick=()=>{
    if(!redoStack.length)return;
    history.push(redoStack.pop());
    redraw();
  };

  widthEl.oninput=e=>brushWidth=+e.target.value;

  clearBtn.onclick=()=>{
    history.length=0;
    redoStack.length=0;
    redraw();
  };

  document.getElementById('burger').onclick=()=>{
    const p=document.getElementById('panel');
    p.style.display=p.style.display==='none'?'block':'none';
  };
})();
</script>
</body>
</html>

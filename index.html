<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>lie2srvv | Ultra Performance</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { background: #0a0a0a; color: #e0e0e0; font-family: 'Montserrat', sans-serif; overflow: hidden; }
        canvas { touch-action: none; }
        .card { background: #141414; border: 1px solid rgba(255,255,255,0.1); border-radius: 2rem; }
        .color-btn { width: 32px; height: 32px; border-radius: 50%; border: 2px solid transparent; transition: 0.2s; }
        .color-btn:active { transform: scale(0.8); }
        .active-color { border-color: white; transform: scale(1.1); }
        .rgb-text { background: linear-gradient(to right, red, orange, yellow, green, cyan, blue, violet); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, Timestamp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";
        window.fb = { initializeApp, getFirestore, collection, addDoc, onSnapshot, Timestamp, getAuth, signInAnonymously };
    </script>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const App = () => {
            const [page, setPage] = useState('info');
            const [city, setCity] = useState('МОСКВА');
            const [paths, setPaths] = useState([]);
            const [currentColor, setCurrentColor] = useState('#FFFFFF');
            const [isRGB, setIsRGB] = useState(false);
            const [hue, setHue] = useState(0);
            const [question, setQuestion] = useState('');
            const [db, setDb] = useState(null);
            const [isAdmin, setIsAdmin] = useState(false);
            const [messages, setMessages] = useState([]);

            const canvasRef = useRef(null);
            const currentPathRef = useRef(null);

            // Инициализация базы
            useEffect(() => {
                if (window.fb && window.__firebase_config) {
                    const app = window.fb.initializeApp(JSON.parse(window.__firebase_config));
                    const _db = window.fb.getFirestore(app);
                    setDb(_db);
                    window.fb.signInAnonymously(window.fb.getAuth(app)).catch(console.error);
                }
            }, []);

            // Анимационный цикл (200Гц Friendly)
            useEffect(() => {
                const handle = requestAnimationFrame(function loop() {
                    setHue(h => (h + 2) % 360);
                    
                    if (page === 'draw' && canvasRef.current) {
                        const ctx = canvasRef.current.getContext('2d');
                        ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);
                        
                        const drawPath = (p) => {
                            if (!p.pts.length) return;
                            ctx.beginPath();
                            ctx.strokeStyle = p.c;
                            ctx.lineWidth = 4;
                            ctx.lineCap = 'round';
                            ctx.lineJoin = 'round';
                            ctx.moveTo(p.pts[0].x, p.pts[0].y);
                            p.pts.forEach(pt => ctx.lineTo(pt.x, pt.y));
                            ctx.stroke();
                        };

                        paths.forEach(drawPath);
                        if (currentPathRef.current) {
                            if (isRGB) currentPathRef.current.c = `hsl(${hue}, 100%, 50%)`;
                            drawPath(currentPathRef.current);
                        }
                    }
                    requestAnimationFrame(loop);
                });
                return () => cancelAnimationFrame(handle);
            }, [page, paths, hue, isRGB]);

<!DOCTYPE html><html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>lie2srvv</title>  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>  <style>
    :root {
      --bg: #0a0a0a;
      --card: #141414;
      --text: #e0e0e0;
    }
    html, body {
      margin: 0;
      width: 100%;
      height: 100%;
      background: var(--bg);
      font-family: Montserrat, sans-serif;
      color: var(--text);
      overflow: hidden;
    }
    #root { width: 100%; height: 100%; }
    canvas { touch-action: none; }
    .card {
      background: var(--card);
      border-radius: 2rem;
      border: 1px solid rgba(255,255,255,.08);
    }
    .color-dot {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      border: 1px solid rgba(255,255,255,.2);
    }
    .color-dot.active {
      transform: scale(1.25);
      border-color: #fff;
    }
  </style></head>
<body>
<div id="root"></div><script type="text/babel">
const { useState, useEffect, useRef } = React;

// ================= FIREBASE CONFIG =================
const firebaseConfig = {
  apiKey: "PASTE_API_KEY",
  authDomain: "PASTE_AUTH_DOMAIN",
  projectId: "PASTE_PROJECT_ID",
};

// ================= APP =================
function App() {
  const [page, setPage] = useState('info');
  const [city, setCity] = useState('......');
  const [question, setQuestion] = useState('');
  const [messages, setMessages] = useState([]);
  const [isAdmin, setIsAdmin] = useState(false);

  const canvasRef = useRef(null);
  const drawing = useRef(false);
  const paths = useRef([]);

  const [color, setColor] = useState('#FFFFFF');
  const [hue, setHue] = useState(0);

  // ===== city animation =====
  useEffect(() => {
    const chars = 'АБВГДЕЁЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯ';
    const i = setInterval(() => {
      setCity(Array.from({length:6},()=>chars[Math.floor(Math.random()*chars.length)]).join(''));
    }, 800);
    return () => clearInterval(i);
  }, []);

  // ===== hue animation =====
  useEffect(() => {
    const i = setInterval(() => setHue(h => (h + 2) % 360), 16);
    return () => clearInterval(i);
  }, []);

  // ===== canvas =====
  const getPos = e => {
    const r = canvasRef.current.getBoundingClientRect();
    const t = e.touches?.[0] || e;
    return { x: t.clientX - r.left, y: t.clientY - r.top };
  };

  const drawSegment = path => {
    const ctx = canvasRef.current.getContext('2d');
    ctx.lineWidth = 3.5;
    ctx.lineCap = 'round';
    ctx.strokeStyle = path.rgb ? `hsl(${path.h},100%,60%)` : path.c;
    ctx.beginPath();
    ctx.moveTo(path.pts[0].x, path.pts[0].y);
    path.pts.forEach(p => ctx.lineTo(p.x, p.y));
    ctx.stroke();
  };

  const startDraw = e => {
    drawing.current = true;
    paths.current.push({
      c: color,
      rgb: color === 'rgb',
      h: hue,
      pts: [getPos(e)]
    });
  };

  const moveDraw = e => {
    if (!drawing.current) return;
    const p = paths.current.at(-1);
    p.pts.push(getPos(e));
    if (p.rgb) p.h = (p.h + 4) % 360;
    drawSegment(p);
  };

  const endDraw = () => drawing.current = false;

  const clearCanvas = () => {
    const c = canvasRef.current;
    c.getContext('2d').clearRect(0,0,c.width,c.height);
    paths.current = [];
  };

  // ===== firebase =====
  useEffect(() => {
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    auth.signInAnonymously();

    db.collection('messages').orderBy('createdAt','desc').onSnapshot(s => {
      setMessages(s.docs.map(d => ({id:d.id,...d.data()})));
    });

    window.__db = db;
  }, []);

  const sendMsg = async () => {
    if (!question.trim()) return;
    await window.__db.collection('messages').add({
      text: question,
      createdAt: new Date()
    });
    setQuestion('');
    alert('Отправлено');
  };

  return (
    <div className="w-full h-full flex items-center justify-center">

      {page === 'info' && (
        <div className="card p-8 w-[320px]">
          <h1 className="text-2xl font-bold mb-4">lie2srvv</h1>
          <p className="text-sm text-gray-400 mb-6">Александр, 16 лет. Программирование, веб.</p>
          <div className="flex justify-between">
            <span>Россия</span>
            <span className="font-mono">{city}</span>
          </div>
          <button onClick={()=>setPage('draw')} className="mt-6 w-full bg-white/10 py-3 rounded-xl">Холст</button>
          <button onClick={()=>setPage('ask')} className="mt-3 w-full bg-white/10 py-3 rounded-xl">Вопросы</button>
        </div>
      )}

      {page === 'draw' && (
        <>
          <canvas
            ref={canvasRef}
            width={innerWidth}
            height={innerHeight}
            onMouseDown={startDraw}
            onMouseMove={moveDraw}
            onMouseUp={endDraw}
            onMouseLeave={endDraw}
            onTouchStart={startDraw}
            onTouchMove={moveDraw}
            onTouchEnd={endDraw}
          />

          <div className="fixed bottom-6 left-1/2 -translate-x-1/2 bg-black/80 p-4 rounded-3xl flex gap-3">
            {['#fff','#f00','#ff0','#0f0','#0ff','#00f','#a0f','#000','rgb'].map(c => (
              <button key={c}
                onClick={()=>setColor(c)}
                className={`color-dot ${color===c?'active':''}`}
                style={{background: c==='rgb'?`linear-gradient(45deg,red,yellow,lime,cyan,blue,magenta)`:c}}
              />
            ))}
            <button onClick={clearCanvas} className="text-xs text-white/60">Очистить</button>
          </div>
        </>
      )}

      {page === 'ask' && (
        <div className="card p-8 w-[320px]">
          {!isAdmin ? (
            <>
              <textarea value={question} onChange={e=>setQuestion(e.target.value)} className="w-full h-32 bg-black/40 rounded-xl p-4 mb-4" placeholder="Анонимный вопрос" />
              <button onClick={sendMsg} className="w-full bg-white text-black py-3 rounded-xl">Отправить</button>
              <button onClick={()=>prompt('Пароль')==='Lie2Admin'&&setIsAdmin(true)} className="mt-4 text-xs text-gray-500">Admin</button>
            </>
          ) : (
            <div className="space-y-3 max-h-[400px] overflow-y-auto">
              {messages.map(m => (
                <div key={m.id} className="bg-white/5 p-4 rounded-xl text-sm">{m.text}</div>
              ))}
            </div>
          )}
        </div>
      )}

    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App />);
</script><script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script><script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script><script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script></body>
</html>

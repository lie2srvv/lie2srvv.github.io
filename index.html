<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>lie2srvv</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<style>
:root {
  --bg: #0a0a0a;
  --card: #141414;
  --text: #e0e0e0;
}
body, html {
  margin: 0; padding: 0; width: 100%; height: 100%;
  font-family: 'Montserrat', sans-serif;
  background: var(--bg); color: var(--text); overflow: hidden; touch-action: none;
}
#root { width: 100%; height: 100%; position: relative; z-index: 10; }
canvas#drawing-canvas { cursor: crosshair; touch-action: none; position: absolute; top:0; left:0; }
.card {
  background: var(--card); border-radius: 2.5rem;
  border: 1px solid rgba(255,255,255,0.07);
  box-shadow: 0 30px 60px -12px rgba(0,0,0,0.7);
  padding: 2rem; max-width: 400px; width: 90%;
}
.color-dot {
  width: 28px; height: 28px; border-radius: 50%;
  border: 1px solid rgba(255,255,255,0.1);
  transition: 0.2s;
}
.color-dot.active { transform: scale(1.3); border-color: #fff; box-shadow:0 0 10px rgba(255,255,255,0.3);}
.rgb-btn {
  background: linear-gradient(45deg,#ff0000,#ff7300,#fffb00,#48ff00,#00ffd5,#002bff,#7a00ff,#ff00c8,#ff0000);
  background-size:400%;
  animation: moveGradient 5s linear infinite;
  border:none;color:white;font-weight:bold;text-shadow:0 1px 2px rgba(0,0,0,0.5);padding:0.3rem 0.6rem;border-radius:1rem;text-[10px];
}
@keyframes moveGradient {0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
</style>
</head>
<body>
<canvas id="snow-canvas"></canvas>
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect, useRef } = React;

// Снег
const startSnow = () => {
  const canvas = document.getElementById('snow-canvas');
  const ctx = canvas.getContext('2d');
  let w,h,particles=[];

  const resize=()=>{w=canvas.width=window.innerWidth; h=canvas.height=window.innerHeight;}
  class Particle{
    constructor(){this.init();}
    init(){
      this.x=Math.random()*w;
      this.y=Math.random()*-h;
      this.size=Math.random()*3+2;
      this.speed=Math.random()*0.5+0.3;
      this.opacity=Math.random()*0.4+0.2;
      this.offset=Math.random()*2000;
    }
    update(){
      this.y+=this.speed;
      this.x+=Math.sin((Date.now()+this.offset)*0.0015)*0.5;
      if(this.y>h)this.init();
    }
    draw(){
      ctx.beginPath();
      const g=ctx.createRadialGradient(this.x,this.y,0,this.x,this.y,this.size);
      g.addColorStop(0,`rgba(255,255,255,${this.opacity})`);
      g.addColorStop(1,'transparent');
      ctx.fillStyle=g;
      ctx.arc(this.x,this.y,this.size,0,Math.PI*2);
      ctx.fill();
    }
  }

  window.addEventListener('resize',resize);
  resize();
  for(let i=0;i<70;i++)particles.push(new Particle());
  const animate=()=>{ctx.clearRect(0,0,w,h);particles.forEach(p=>{p.update();p.draw();});requestAnimationFrame(animate);}
  animate();
};

const App = () => {
  const [page,setPage] = useState('info');
  const [city,setCity] = useState('МОСКВА');
  const [paths,setPaths] = useState([]);
  const [brushWidth,setBrushWidth] = useState(4);
  const [isRGB,setIsRGB] = useState(false);
  const [customColor,setCustomColor] = useState('#ffffff');
  const [hue,setHue] = useState(0);

  const canvasRef = useRef(null);
  const currentPathRef = useRef(null);

  useEffect(()=>{startSnow();},[]);

  // Быстро меняющийся город
  useEffect(()=>{
    const chars = "абвгдеёжзийклмнопрстуфхцчшщъыьэюя";
    const interval=setInterval(()=>{
      setCity(Array.from({length:6},()=>chars[Math.floor(Math.random()*chars.length)]).join('').toUpperCase());
    },150);
    return ()=>clearInterval(interval);
  },[]);

  // Ху для градиента
  useEffect(()=>{
    const interval=setInterval(()=>setHue(h=> (h+2)%360),30);
    return ()=>clearInterval(interval);
  },[]);

  const getPos=(e)=>{
    const rect=canvasRef.current.getBoundingClientRect();
    const clientX=e.clientX || (e.touches && e.touches[0].clientX);
    const clientY=e.clientY || (e.touches && e.touches[0].clientY);
    return {x: clientX - rect.left, y: clientY - rect.top};
  };

  const redraw = () => {
    if(!canvasRef.current) return;
    const ctx=canvasRef.current.getContext('2d');
    ctx.clearRect(0,0,canvasRef.current.width, canvasRef.current.height);
    paths.forEach(drawPath);
    if(currentPathRef.current) drawPath(currentPathRef.current);
  };

  const drawPath = (path)=>{
    if(!path || !path.pts.length) return;
    const ctx=canvasRef.current.getContext('2d');
    ctx.lineWidth = path.width;
    ctx.lineCap = 'round';
    ctx.lineJoin = 'round';
    for(let i=0;i<path.pts.length-1;i++){
      const p1=path.pts[i], p2=path.pts[i+1];
      const hueVal=(path.hueStart+i*2)%360;
      ctx.strokeStyle = path.isRGB ? `hsl(${hueVal},100%,65%)` : path.color;
      ctx.beginPath();
      ctx.moveTo(p1.x,p1.y);
      ctx.lineTo(p2.x,p2.y);
      ctx.stroke();
    }
  };

  const startDrawing=(e)=>{
    currentPathRef.current={
      pts:[getPos(e)],
      hueStart:hue,
      width:brushWidth,
      color:customColor,
      isRGB:isRGB
    };
  };

  const moveDrawing=(e)=>{
    if(!currentPathRef.current) return;
    currentPathRef.current.pts.push(getPos(e));
    redraw();
  };

  const endDrawing=()=>{
    if(currentPathRef.current){
      setPaths(prev=>[...prev,currentPathRef.current]);
      currentPathRef.current=null;
      redraw();
    }
  };

  return (
    <div className="w-full h-full flex items-center justify-center p-4 relative">
      <main className="w-full h-full flex items-center justify-center">
        {page==='info' && (
          <div className="card">
            <h1 className="text-3xl font-bold mb-4">lie2srvv</h1>
            <p className="text-sm text-[#999] mb-6">Александр, 16 лет. Увлекаюсь программированием, люблю логические задачки.</p>
            <div className="flex justify-between mb-6">
              <span>Страна: Россия</span>
              <span className="font-mono uppercase">{city}</span>
            </div>
            <a href="https://t.me/lie2survive" target="_blank" className="block text-center p-3 bg-white/5 border border-white/5 rounded-xl font-bold text-xs uppercase mb-2">Telegram</a>
            <button onClick={()=>setPage('draw')} className="w-full bg-white/10 py-2 rounded-xl">Холст</button>
          </div>
        )}

        {page==='draw' && (
          <>
            <canvas ref={canvasRef} id="drawing-canvas" width={window.innerWidth} height={window.innerHeight}
              onMouseDown={startDrawing} onMouseMove={moveDrawing} onMouseUp={endDrawing} onMouseLeave={endDrawing}
              onTouchStart={startDrawing} onTouchMove={moveDrawing} onTouchEnd={endDrawing}
            />
            <div className="fixed bottom-10 left-1/2 -translate-x-1/2 flex flex-col items-center gap-3 bg-[#141414]/95 backdrop-blur-2xl p-4 rounded-3xl border border-white/10 shadow-2xl">
              <div className="flex gap-2 items-center flex-wrap justify-center">
                <input type="color" value={customColor} onChange={e=>setCustomColor(e.target.value)} className="color-dot"/>
                <button onClick={()=>setIsRGB(false)} className={`px-3 py-1 rounded-full text-[10px] ${!isRGB?'ring-2 ring-white':''}`}>Цвет</button>
                <button onClick={()=>setIsRGB(true)} className={`rgb-btn ${isRGB?'ring-2 ring-white':''}`}>RGB</button>
              </div>
              <div className="flex items-center gap-2">
                <span className="text-[10px]">Толщина:</span>
                <input type="range" min="1" max="20" value={brushWidth} onChange={e=>setBrushWidth(e.target.value)} className="w-40"/>
              </div>
              <button onClick={()=>{setPaths([]); redraw();}} className="text-[10px] font-bold uppercase tracking-widest text-[#333] hover:text-white transition-colors mt-2">Очистить</button>
              <button onClick={()=>setPage('info')} className="text-[10px] font-bold uppercase tracking-widest text-[#333] hover:text-white transition-colors mt-1">Назад</button>
            </div>
          </>
        )}
      </main>
    </div>
  );
};

ReactDOM.createRoot(document.getElementById('root')).render(<App />);
</script>
</body>
</html>
